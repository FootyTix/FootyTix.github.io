<!-- テストページ -->
<script type="text/javascript">// <![CDATA[
    $(function ($) {
        $('#pref-select').change(function () {
            var select_val = $('#pref-select option:selected').val();
            $.each($("#pref-table tbody tr"), function (index, element) {
                if (select_val == "") {
                    $(element).css("display", "table-row");
                    return true;
                }
                var row_text = $(element).text();
                if (row_text.indexOf(select_val) != -1) {
                    $(element).css("display", "table-row");
                } else {
                    $(element).css("display", "none");
                }
            });
        });
    });
    $(function () {
        $.ajaxSetup({
            headers: { "X-Auth-Token": "28fcc697165249959737b7f980aeefd2" }
        });
        $.when(
            $.getJSON("https://api.football-data.org/v2/competitions/PL/matches"),
            $.getJSON('https://api.football-data.org/v2/competitions/BL1/matches'),
            $.getJSON('https://api.football-data.org/v2/competitions/PD/matches'),
            $.getJSON('https://api.football-data.org/v2/competitions/SA/matches'),
            $.getJSON('https://api.football-data.org/v2/competitions/FL1/matches'),
            $.getJSON('https://api.football-data.org/v2/competitions/CL/matches')
        )
            .done(function (data_PL, data_BL, data_PD, data_SA, data_FL, data_CL) {
                PL = data_PL[0].matches;
                PL.forEach(function (match) {
                    match.competition = data_PL[0].competition
                    match.competition.img = "🏴󠁧󠁢󠁥󠁮󠁧󠁿"
                    match.td_class = "td-pl"
                });
                BL = data_BL[0].matches;
                BL.forEach(function (match) {
                    match.competition = data_BL[0].competition
                    match.competition.img = "🇩🇪"
                    match.td_class = "td-bl"
                });
                PD = data_PD[0].matches;
                PD.forEach(function (match) {
                    match.competition = data_PD[0].competition
                    match.competition.img = "🇪🇸"
                    match.td_class = "td-pd"
                });
                SA = data_SA[0].matches;
                SA.forEach(function (match) {
                    match.competition = data_SA[0].competition
                    match.competition.img = "🇮🇹"
                    match.td_class = "td-sa"
                });
                FL = data_FL[0].matches;
                FL.forEach(function (match) {
                    match.competition = data_FL[0].competition
                    match.competition.img = "🇫🇷"
                    match.td_class = "td-fl"
                });
                CL = data_CL[0].matches;
                CL.forEach(function (match) {
                    match.competition = data_CL[0].competition
                    match.competition.img = '<img title="f:id:ktakumi11:20190618030228j:plain" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/ktakumi11/20190618/20190618030228.jpg" alt="f:id:ktakumi11:20190618030228j:plain" />'
                    match.td_class = "td-cl"
                });

                games_num = data_PL[0].count
                    + data_BL[0].count
                    + data_PD[0].count
                    + data_SA[0].count
                    + data_FL[0].count;

                game_list = PL.concat(BL, PD, SA, FL)

                game_list.sort(function (a, b) {
                    if (a.utcDate > b.utcDate) {
                        return 1;
                    } else {
                        return -1;
                    }
                });

                var club_list = {
                    'Liverpool FC': 'リバプール',
                    'Manchester City FC': 'マンチェスター・C',
                    'Manchester United FC': 'マンチェスター・U',
                    'Arsenal FC': 'アーセナル',
                    'Tottenham Hotspur FC': 'トッテナム',
                    'Chelsea FC': 'チェルシー',
                    'Everton FC': 'エバートン',
                    'FC Bayern München': 'バイエルン',
                    'BV Borussia 09 Dortmund': 'ドルトムント',
                    'RB Leipzig': 'ライプツィヒ',
                    'FC Schalke 04': 'シャルケ',
                    'FC Barcelona': 'バルセロナ',
                    'Real Madrid CF': 'レアル・マドリー',
                    'Club Atlético de Madrid': 'アトレティコ',
                    'Sevilla FC': 'セビージャ',
                    'Villarreal CF': 'ビジャレアル',
                    'Juventus FC': 'ユベントス',
                    'SSC Napoli': 'ナポリ',
                    'AS Roma': 'ローマ',
                    'FC Internazionale Milano': 'インテル',
                    'AC Milan': 'ACミラン',
                    'Atalanta BC': 'アタランタ',
                    'SS Lazio': 'ラツィオ',
                    'Paris Saint-Germain FC': 'PSG',
                    'Olympique de Marseille': 'マルセイユ',
                    'Olympique Lyonnais': 'リヨン'
                };

                var youbi = ["日", "月", "火", "水", "木", "金", "土"];
                var date, jdate;
                var jtime = "";

                for (var i = 0; i < games_num; i++) {
                    if (club_list[game_list[i].homeTeam.name] && club_list[game_list[i].awayTeam.name]
                        && game_list[i].status == 'SCHEDULED') {
                        date = new Date(game_list[i].utcDate);
                        date = date.toLocaleString("ja-JP");
                        jdate = new Date(date);
                        jtime = jdate.getHours() == 9 ? '未定' : (jdate.getHours() + ':' + ("0" + jdate.getMinutes()).slice(-2));
                        $("#matches-tbl").append(
                            '<tr align="center">'
                            + '<td><span style="font-size: 80%;">'
                            + club_list[game_list[i].homeTeam.name] + '</span></td>'
                            + '<td class="' + game_list[i].td_class + '"><span style="font-size: 60%;">'
                            + (jdate.getMonth() + 1) + '/' + jdate.getDate() + '(' + youbi[jdate.getDay()] + ') '
                            + '<br />' + jtime + '<br />'
                            + game_list[i].competition.img + '󠁢󠁥󠁮󠁧󠁿 第' +
                            + game_list[i].matchday + '節</span></td>'
                            + '<td><span style="font-size: 80%;">'
                            + club_list[game_list[i].awayTeam.name] + '</span></td>'
                            + '</tr>'
                        );
                    }
                }
                $('#loading-gif').remove();
            })
            .fail(function () {
                // エラーがあった時
                $(".matchresults-end").before('<p>エラー</p>');
            });
    });
    // ]]></script>
</p>
<h3>試合一覧</h3>
<div id="pref-search"><select id="pref-select" class="form-control">
        <option value="">クラブ別で絞り込み</option>
        <optgroup label="プレミアリーグ">
            <option value="マンチェスター・U">マンチェスター・U</option>
            <option value="マンチェスター・C">マンチェスター・C</option>
            <option value="リバプール">リバプール</option>
            <option value="チェルシー">チェルシー</option>
            <option value="アーセナル">アーセナル</option>
            <option value="トッテナム">トッテナム</option>
            <option value="エバートン">エバートン</option>
        </optgroup>
        <optgroup label="セリエA">
            <option value="ユベントス">ユベントス</option>
            <option value="ナポリ">ナポリ</option>
            <option value="インテル">インテル</option>
            <option value="ACミラン">ACミラン</option>
            <option value="ローマ">ローマ</option>
            <option value="ラツィオ">ラツィオ</option>
            <option value="アタランタ">アタランタ</option>
        </optgroup>
        <optgroup label="ラ・リーガ">
            <option value="レアル・マドリー">レアル・マドリー</option>
            <option value="バルセロナ">バルセロナ</option>
            <option value="アトレティコ">アトレティコ</option>
            <option value="セビージャ">セビージャ</option>
            <option value="ビジャレアル">ビジャレアル</option>
        </optgroup>
        <optgroup label="ブンデスリーガ">
            <option value="バイエルン">バイエルン</option>
            <option value="ドルトムント">ドルトムント</option>
            <option value="ライプツィヒ">ライプツィヒ</option>
            <option value="シャルケ">シャルケ</option>
        </optgroup>
        <optgroup label="リーグ・アン">
            <option value="PSG">PSG</option>
            <option value="マルセイユ">マルセイユ</option>
            <option value="リヨン">リヨン</option>
        </optgroup>
    </select></div>
<p> </p>
<table id="pref-table" class="table-borderd">
    <thead>
        <tr align="center">
            <th width="40%"><span style="font-size: 80%;">ホーム</span></th>
            <th width="20%"><span style="font-size: 60%;">日時<br />(日本時間)<br />リーグ 節</span></th>
            <th width="40%"><span style="font-size: 80%;">アウェイ</span></th>
        </tr>
    </thead>
    <tbody id="matches-tbl">
        <tr>
            <td id="loading-gif" colspan="3" align="center"><img
                    src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/ktakumi11/20200908/20200908215938.gif"
                    alt="f:id:ktakumi11:20200908215938g:plain" title="f:id:ktakumi11:20200908215938g:plain"
                    itemprop="image" /></td>
        </tr>
    </tbody>
</table>
<div class="matchresults-end"></div>